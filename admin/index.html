<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تسجيل الدخول — لوحة تحكم ليالي</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;500;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { --purple: #9f7aea; --pink: #ed64a6; --white: #fafafa; --text: #111; --text-soft: #333; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Kufi Arabic', 'Poppins', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #f8f5ff 0%, #fef5f8 100%);
      padding: 1rem;
      direction: rtl;
    }
    .login-card {
      width: 100%;
      max-width: 400px;
      padding: 2rem;
      background: var(--white);
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(159, 122, 234, 0.15);
      border: 1px solid rgba(159, 122, 234, 0.1);
    }
    .login-card h1 {
      font-size: 1.5rem;
      color: var(--text);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .login-card label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.4rem;
    }
    .login-card input {
      width: 100%;
      padding: 0.85rem 1rem;
      font-size: 1rem;
      border: 2px solid rgba(159, 122, 234, 0.2);
      border-radius: 12px;
      margin-bottom: 1rem;
      font-family: inherit;
    }
    .login-card input:focus {
      outline: none;
      border-color: var(--purple);
    }
    .login-card button {
      width: 100%;
      padding: 0.9rem;
      font-size: 1rem;
      font-weight: 700;
      font-family: inherit;
      color: var(--white);
      background: linear-gradient(135deg, var(--purple), var(--pink));
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .login-card button:hover { opacity: 0.95; }
    .login-card button:disabled { opacity: 0.7; cursor: not-allowed; }
    .login-msg {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 10px;
      font-size: 0.9rem;
      text-align: center;
      display: none;
    }
    .login-msg.error { background: rgba(239,68,68,0.1); color: #b91c1c; display: block; }
    .login-msg.success { background: rgba(34,197,94,0.1); color: #166534; display: block; }
    .back-link {
      display: block;
      text-align: center;
      margin-top: 1.25rem;
      color: var(--text-soft);
      font-size: 0.9rem;
      text-decoration: none;
    }
    .back-link:hover { color: var(--purple); }
  </style>
</head>
<body>
  <div class="login-card">
    <h1>لوحة تحكم ليالي</h1>
    <form id="login-form">
      <label for="email">البريد الإلكتروني</label>
      <input type="email" id="email" name="email" required placeholder="admin@example.com" />
      <label for="password">كلمة المرور</label>
      <input type="password" id="password" name="password" required placeholder="••••••••" />
      <button type="submit" id="login-btn">تسجيل الدخول</button>
    </form>
    <div id="login-msg" class="login-msg" aria-live="polite"></div>
    <a href="../index.html" class="back-link">← العودة للرئيسية</a>
  </div>

  <script src="../js/supabase.min.js"></script>
  <script src="../config.js"></script>
  <script>
    (function () {
      var form = document.getElementById('login-form');
      var msgEl = document.getElementById('login-msg');
      var btn = document.getElementById('login-btn');
      if (!form || !msgEl) return;
      function showMsg(text, isError) {
        msgEl.textContent = text;
        msgEl.className = 'login-msg ' + (isError ? 'error' : 'success');
      }
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        var url = window.SUPABASE_URL;
        var key = window.SUPABASE_ANON_KEY;
        if (!url || !key) {
          showMsg('أضف config.js مع SUPABASE_URL و SUPABASE_ANON_KEY', true);
          return;
        }
        if (!window.supabase || !window.supabase.createClient) {
          showMsg('لم يتم تحميل Supabase. تحقق من الاتصال أو جرّب متصفحاً آخر.', true);
          return;
        }
        msgEl.className = 'login-msg';
        msgEl.textContent = '';
        btn.disabled = true;
        btn.textContent = 'جاري الدخول...';
        var supabase = window.supabase.createClient(url, key);
        supabase.auth.signInWithPassword({
          email: form.email.value.trim(),
          password: form.password.value
        }).then(function (res) {
          if (res.error) throw res.error;
          showMsg('تم تسجيل الدخول. جاري التحويل...', false);
          window.location.href = 'dashboard.html';
        }).catch(function (err) {
          showMsg(err.message || 'فشل تسجيل الدخول', true);
          btn.disabled = false;
          btn.textContent = 'تسجيل الدخول';
        });
      });
    })();
  </script>
</body>
</html>
